# Development Dockerfile for .NET API with hot reload support
FROM mcr.microsoft.com/dotnet/sdk:10.0

WORKDIR /app

# Install debugger
RUN curl -sSL https://aka.ms/getvsdbgsh | bash /dev/stdin -v latest -l /vsdbg

# Install dotnet tools globally
ENV PATH="${PATH}:/root/.dotnet/tools"
RUN dotnet tool install --global dotnet-ef
RUN dotnet tool install --global dotnet-watch

# Copy project files (restore deferred to runtime)
COPY *.csproj ./
COPY . ./

# Set environment variables for development
ENV DOTNET_USE_POLLING_FILE_WATCHER=1
ENV ASPNETCORE_ENVIRONMENT=Development
ENV DOTNET_WATCH_RESTART_ON_RUDE_EDIT=1
ENV NUGET_PACKAGES=/nuget

EXPOSE 5000

# dotnet watch will restore on first run using the mounted cache volume
CMD ["dotnet", "watch", "run", "--urls", "http://0.0.0.0:5000"]